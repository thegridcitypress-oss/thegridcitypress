<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>The Grid City Press</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Playfair Display', serif; background-color: #f9f9f9; color: #111; }
        header { position: relative; background-color: white; border-bottom: 1px solid #ccc; padding: 30px 20px 20px; }
        .header-inner { text-align: center; }
        header h1 { font-size: 3rem; font-weight: 700; letter-spacing: 1px; margin: 0; }
        nav.main-nav { margin-top: 20px; margin-bottom: 30px; }
        .nav-left { text-align: center; }
        .nav-left a { text-decoration: none; color: #444; margin: 0 15px; font-weight: 600; font-size: 1rem; cursor: pointer; }
        .nav-left a:hover { color: #000; }
        .nav-right { position: absolute; top: 35px; right: 20px; }
        .nav-right a, .nav-right button { text-decoration: none; color: #444; margin: 0 10px; font-weight: 600; font-size: 1rem; background: none; border: none; cursor: pointer; font-family: inherit; }
        .nav-right a:hover, .nav-right button:hover { color: #000; }
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px 40px; }
        h2.section-title { font-size: 1.8rem; margin: 20px 0 15px; font-weight: 700; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .article-link { display: block; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; text-decoration: none; color: inherit; transition: background-color 0.2s ease; cursor: pointer; }
        .article-link:hover { background-color: #f0f0f0; }
        .article-link h3 { margin: 0 0 5px; font-size: 1.4rem; }
        .article-link small { color: #777; font-size: 0.9rem; }
        footer { text-align: center; color: #aaa; font-size: 0.8rem; padding: 20px; border-top: 1px solid #ddd; }
        .article-view { display: none; }
        .article-view.active { display: block; }
        .article-content { margin-top: 30px; line-height: 1.8; }
        .article-content p { margin-bottom: 1.2em; }
        .back-link { display: inline-block; margin-top: 30px; text-decoration: none; color: #444; font-weight: 600; cursor: pointer; }
        .back-link:hover { color: #000; }
        .auth-container { display: none; max-width: 600px; margin: 50px auto; padding: 0 20px; }
        .auth-container.active { display: block; }
        .auth-container h1 { text-align: center; margin-bottom: 30px; }
        .auth-form label { display: block; margin-top: 20px; font-weight: bold; }
        .auth-form input, .auth-form select { width: 100%; padding: 10px; margin-top: 5px; font-family: inherit; font-size: inherit; border: 1px solid #ccc; }
        .auth-form button { margin-top: 20px; padding: 10px 20px; background-color: #000; color: #fff; border: none; cursor: pointer; font-family: inherit; font-size: inherit; }
        .auth-form button:hover { background-color: #333; }
        .message { margin-top: 20px; padding: 10px; font-weight: bold; color: darkgreen; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px; }
        .message.error { color: darkred; background-color: #ffebee; border-color: #f44336; }
        .auth-links { margin-top: 20px; }
        .auth-links a { color: #444; text-decoration: none; display: block; margin-top: 10px; cursor: pointer; }
        .hidden { display: none; }
        .profile-container { display: none; max-width: 600px; margin: 50px auto; padding: 0 20px; }
        .profile-container.active { display: block; }
        .profile-info { margin: 20px 0; }
        .profile-info p { margin: 10px 0; }
        .links { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
        .links a, .links button { text-decoration: none; background-color: #000; color: #fff; padding: 10px 15px; font-weight: 600; text-align: center; border-radius: 4px; cursor: pointer; border: none; font-family: inherit; font-size: inherit; }
        .links a:hover, .links button:hover { background-color: #333; }
        #editor { border: 1px solid #ccc; padding: 15px; min-height: 300px; background-color: white; margin-top: 5px; overflow-y: auto; }
        .delete-button { margin-top: 10px; display: inline-block; padding: 6px 12px; background-color: crimson; color: white; text-decoration: none; font-size: 0.9rem; border-radius: 4px; border: none; cursor: pointer; font-family: inherit; }
        .delete-button:hover { background-color: darkred; }
        @media (max-width: 768px) {
            header h1 { font-size: 2rem; }
            .nav-right { position: static; text-align: center; margin-top: 15px; }
            .nav-left a { display: block; margin: 10px 0; }
        }
    </style>
</head>
<body>
    <!-- HOME -->
    <div id="home-page">
        <header>
            <div class="header-inner"><h1>The Grid City Press</h1></div>
            <nav class="main-nav">
                <div class="nav-left">
                    <a onclick="showHome()">Home</a>
                    <a onclick="filterByTeam('Utah Athletics')">Utah Athletics</a>
                    <a onclick="filterByTeam('Utah Mammoth')">Utah Mammoth</a>
                    <a onclick="filterByTeam('Utah Jazz')">Utah Jazz</a>
                </div>
                <div class="nav-right" id="nav-auth">
                    <a onclick="showLogin()">Log In</a>
                    <a onclick="showRegister()">Register</a>
                </div>
            </nav>
        </header>
        <div class="container">
            <h2 class="section-title" id="articles-title">Latest Articles</h2>
            <div id="articles-list"></div>
        </div>
        <footer>&copy; <span id="year"></span> The Grid City Press. All rights reserved.</footer>
    </div>

    <!-- ARTICLE VIEW -->
    <div id="article-page" class="article-view">
        <header><div class="header-inner"><h1>The Grid City Press</h1></div></header>
        <div class="container">
            <h1 id="view-article-title"></h1>
            <small id="article-meta"></small>
            <div class="article-content" id="article-content"></div>
            <a class="back-link" onclick="showHome()">← Back to Home</a>
        </div>
    </div>

    <!-- LOGIN -->
    <div id="login-page" class="auth-container">
        <h1>Log In</h1>
        <div id="login-message"></div>
        <form class="auth-form" onsubmit="handleLogin(event)">
            <label for="login-username">Username</label>
            <input type="text" id="login-username" required>
            <label for="login-password">Password</label>
            <input type="password" id="login-password" required>
            <button type="submit">Log In</button>
        </form>
        <div class="auth-links">
            <a onclick="showRegister()">→ Create an Account</a>
            <a onclick="showHome()">← Back to Home</a>
        </div>
    </div>

    <!-- REGISTER -->
    <div id="register-page" class="auth-container">
        <h1>Create Account</h1>
        <div id="register-message"></div>
        <form class="auth-form" onsubmit="handleRegister(event)">
            <label for="reg-username">Username</label>
            <input type="text" id="reg-username" required>
            <label for="reg-password">Password</label>
            <input type="password" id="reg-password" required>
            <label for="reg-role">I am a…</label>
            <select id="reg-role" required onchange="toggleAdminSecret()">
                <option value="">-- Select Role --</option>
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <div id="admin-secret-container" class="hidden">
                <label for="admin-secret">Admin Secret</label>
                <input type="password" id="admin-secret">
            </div>
            <button type="submit">Register</button>
        </form>
        <div class="auth-links">
            <a onclick="showLogin()">← Back to Log In</a>
            <a onclick="showHome()">← Back to Home</a>
        </div>
    </div>

    <!-- PROFILE -->
    <div id="profile-page" class="profile-container">
        <h1>Your Profile</h1>
        <div class="profile-info">
            <p><strong>Username:</strong> <span id="profile-username"></span></p>
            <p><strong>Role:</strong> <span id="profile-role"></span></p>
        </div>
        <div class="links">
            <button onclick="showUpdateProfile()">Update Profile</button>
            <div id="admin-actions" class="hidden">
                <button onclick="showAddArticle()">Add Article</button>
                <button onclick="showDeleteArticles()">Delete Articles</button>
            </div>
            <button onclick="handleLogout()">Log Out</button>
        </div>
        <a class="back-link" onclick="showHome()">← Back to Home</a>
    </div>

    <!-- UPDATE PROFILE -->
    <div id="update-profile-page" class="auth-container">
        <h1>Update Profile</h1>
        <div id="update-message"></div>
        <form class="auth-form" onsubmit="handleUpdateProfile(event)">
            <label for="update-username">Username</label>
            <input type="text" id="update-username" required>
            <label for="update-password">New Password <small>(leave blank to keep current)</small></label>
            <input type="password" id="update-password">
            <label for="update-role">Role</label>
            <select id="update-role" required onchange="toggleUpdateAdminSecret()">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <div id="update-admin-secret-container" class="hidden">
                <label for="update-admin-secret">Admin Secret</label>
                <input type="password" id="update-admin-secret">
            </div>
            <button type="submit">Save Changes</button>
        </form>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>

    <!-- ADD ARTICLE -->
    <div id="add-article-page" class="auth-container">
        <h1>Publish a New Article</h1>
        <div id="add-article-message"></div>
        <form class="auth-form" onsubmit="handleAddArticle(event)">
            <label for="new-article-title">Title</label>
            <input type="text" id="new-article-title" required>
            <label for="editor">Full Article (Paste from Google Docs)</label>
            <div id="editor" contenteditable="true"></div>
            <label for="article-team">Team</label>
            <select id="article-team" required>
                <option value="">-- Choose a Team --</option>
                <option value="Utah Athletics">Utah Athletics</option>
                <option value="Utah Mammoth">Utah Mammoth</option>
                <option value="Utah Jazz">Utah Jazz</option>
            </select>
            <button type="submit">Publish Article</button>
        </form>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>

    <!-- DELETE ARTICLES -->
    <div id="delete-articles-page" class="auth-container">
        <h1>Delete Articles</h1>
        <div id="delete-message"></div>
        <div id="delete-articles-list"></div>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>

    <script>
        /* ======= Data (articles stored in localStorage for persistence) ======= */
        const DEFAULT_ARTICLES = []; // <-- clean slate, no articles yet

        let articles = [];
        let users = [];
        let currentUser = null;
        let currentFilter = null;

        document.getElementById('year').textContent = new Date().getFullYear();

        /* ======= Persistence ======= */
        function loadUsers() {
            const saved = localStorage.getItem('gridCityUsers');
            if (saved) users = JSON.parse(saved);
            else {
                users = [{ username: 'admin', password: 'toor', role: 'admin' }];
                saveUsers();
            }
        }
        function saveUsers() { localStorage.setItem('gridCityUsers', JSON.stringify(users)); }

        function loadArticles() {
            const saved = localStorage.getItem('gridCityArticles');
            if (saved) articles = JSON.parse(saved);
            else {
                articles = DEFAULT_ARTICLES.slice(); // [] clean slate
                saveArticles();
            }
        }
        function saveArticles() { localStorage.setItem('gridCityArticles', JSON.stringify(articles)); }

        function loadCurrentUser() {
            const saved = localStorage.getItem('gridCityCurrentUser');
            if (saved) currentUser = JSON.parse(saved);
        }

        /* ======= Init ======= */
        loadUsers();
        loadArticles();
        loadCurrentUser();
        updateAuthUI();
        showHome();

        /* ======= UI / Navigation ======= */
        function updateAuthUI() {
            const navAuth = document.getElementById('nav-auth');
            if (currentUser) {
                navAuth.innerHTML = '<a onclick="showProfile()">' + escapeHtml(currentUser.username) + '</a><button onclick="handleLogout()">Log Out</button>';
            } else {
                navAuth.innerHTML = '<a onclick="showLogin()">Log In</a><a onclick="showRegister()">Register</a>';
            }
        }

        function hideAllPages() {
            document.getElementById('home-page').style.display = 'none';
            document.querySelectorAll('.article-view, .auth-container, .profile-container').forEach(el => el.classList.remove('active'));
        }

        function showHome() {
            hideAllPages();
            currentFilter = null;
            document.getElementById('home-page').style.display = 'block';
            displayArticles();
            window.scrollTo(0, 0);
        }

        function filterByTeam(team) {
            currentFilter = team;
            hideAllPages();
            document.getElementById('home-page').style.display = 'block';
            displayArticles(team);
            window.scrollTo(0, 0);
        }

        function showArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;
            document.getElementById('view-article-title').textContent = article.title;
            document.getElementById('article-meta').textContent = article.team + ' | ' + formatDate(article.published_at);
            document.getElementById('article-content').innerHTML = article.content;
            hideAllPages();
            document.getElementById('article-page').classList.add('active');
            window.scrollTo(0, 0);
        }

        function showLogin() {
            hideAllPages();
            document.getElementById('login-message').innerHTML = '';
            document.getElementById('login-page').classList.add('active');
            window.scrollTo(0, 0);
        }

        function showRegister() {
            hideAllPages();
            document.getElementById('register-message').innerHTML = '';
            document.getElementById('reg-username').value = '';
            document.getElementById('reg-password').value = '';
            document.getElementById('reg-role').value = '';
            document.getElementById('admin-secret').value = '';
            document.getElementById('admin-secret-container').classList.add('hidden');
            document.getElementById('register-page').classList.add('active');
            window.scrollTo(0, 0);
        }

        function showProfile() {
            if (!currentUser) { showLogin(); return; }
            document.getElementById('profile-username').textContent = currentUser.username;
            document.getElementById('profile-role').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('admin-actions').classList.toggle('hidden', currentUser.role !== 'admin');
            hideAllPages();
            document.getElementById('profile-page').classList.add('active');
           
