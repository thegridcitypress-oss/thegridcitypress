<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>The Grid City Press</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  body { font-family: 'Playfair Display', serif; background-color: #f9f9f9; color: #111; }
Â  Â  Â  Â  header { position: relative; background-color: white; border-bottom: 1px solid #ccc; padding: 30px 20px 20px; }
Â  Â  Â  Â  .header-inner { display: flex; align-items: center; justify-content: center; gap: 20px; max-width: 1000px; margin: 0 auto; }
Â  Â  Â  Â  .logo { width: 80px; height: 80px; flex-shrink: 0; }
Â  Â  Â  Â  header h1 { font-size: 3rem; font-weight: 700; letter-spacing: 1px; margin: 0; }
Â  Â  Â  Â  nav.main-nav { margin-top: 20px; margin-bottom: 30px; }
Â  Â  Â  Â  .nav-left { text-align: center; }
Â  Â  Â  Â  .nav-left a { text-decoration: none; color: #444; margin: 0 15px; font-weight: 600; font-size: 1rem; cursor: pointer; }
Â  Â  Â  Â  .nav-left a:hover { color: #000; }
Â  Â  Â  Â  .nav-right { position: absolute; top: 35px; right: 20px; }
Â  Â  Â  Â  .nav-right a, .nav-right button { text-decoration: none; color: #444; margin: 0 10px; font-weight: 600; font-size: 1rem; background: none; border: none; cursor: pointer; font-family: inherit; }
Â  Â  Â  Â  .nav-right a:hover, .nav-right button:hover { color: #000; }
Â  Â  Â  Â  .container { max-width: 800px; margin: 0 auto; padding: 0 20px 40px; }
Â  Â  Â  Â  h2.section-title { font-size: 1.8rem; margin: 20px 0 15px; font-weight: 700; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
Â  Â  Â  Â  .article-link { display: block; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; text-decoration: none; color: inherit; transition: background-color 0.2s ease; cursor: pointer; }
Â  Â  Â  Â  .article-link:hover { background-color: #f0f0f0; }
Â  Â  Â  Â  .article-link h3 { margin: 0 0 5px; font-size: 1.4rem; }
Â  Â  Â  Â  .article-link small { color: #777; font-size: 0.9rem; }
Â  Â  Â  Â  footer { text-align: center; color: #aaa; font-size: 0.8rem; padding: 20px; border-top: 1px solid #ddd; }
Â  Â  Â  Â  .page { display: none; }
Â  Â  Â  Â  .page.active { display: block; }
Â  Â  Â  Â  .article-content { margin-top: 30px; line-height: 1.8; }
Â  Â  Â  Â  .article-content p { margin-bottom: 1.2em; }
Â  Â  Â  Â  .back-link { display: inline-block; margin-top: 30px; text-decoration: none; color: #444; font-weight: 600; cursor: pointer; }
Â  Â  Â  Â  .back-link:hover { color: #000; text-decoration: underline; }
Â  Â  Â  Â  .auth-container { max-width: 600px; margin: 50px auto; padding: 0 20px; }
Â  Â  Â  Â  .auth-container h1 { text-align: center; margin-bottom: 30px; }
Â  Â  Â  Â  .auth-form label { display: block; margin-top: 20px; font-weight: bold; }
Â  Â  Â  Â  .auth-form input, .auth-form select { width: 100%; padding: 10px; margin-top: 5px; font-family: inherit; font-size: inherit; border: 1px solid #ccc; }
Â  Â  Â  Â  .auth-form button { margin-top: 20px; padding: 10px 20px; background-color: #000; color: #fff; border: none; cursor: pointer; font-family: inherit; font-size: inherit; }
Â  Â  Â  Â  .auth-form button:hover { background-color: #333; }
Â  Â  Â  Â  .message { margin-top: 20px; padding: 10px; font-weight: bold; color: darkgreen; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px; }
Â  Â  Â  Â  .message.error { color: darkred; background-color: #ffebee; border-color: #f44336; }
Â  Â  Â  Â  .auth-links { margin-top: 20px; }
Â  Â  Â  Â  .auth-links a { color: #444; text-decoration: none; display: block; margin-top: 10px; cursor: pointer; }
Â  Â  Â  Â  .hidden { display: none; }
Â  Â  Â  Â  .profile-info { margin: 20px 0; }
Â  Â  Â  Â  .profile-info p { margin: 10px 0; }
Â  Â  Â  Â  .links { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
Â  Â  Â  Â  .links a, .links button { text-decoration: none; background-color: #000; color: #fff; padding: 10px 15px; font-weight: 600; text-align: center; border-radius: 4px; cursor: pointer; border: none; font-family: inherit; font-size: inherit; }
Â  Â  Â  Â  .links a:hover, .links button:hover { background-color: #333; }
Â  Â  Â  Â  #editor { border: 1px solid #ccc; padding: 15px; min-height: 300px; background-color: white; margin-top: 5px; overflow-y: auto; }
Â  Â  Â  Â  .delete-button { margin-top: 10px; display: inline-block; padding: 6px 12px; background-color: crimson; color: white; text-decoration: none; font-size: 0.9rem; border-radius: 4px; border: none; cursor: pointer; font-family: inherit; }
Â  Â  Â  Â  .delete-button:hover { background-color: darkred; }
Â  Â  Â  Â  .empty-state { text-align: center; padding: 40px 20px; color: #777; }
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  header h1 { font-size: 2rem; }
Â  Â  Â  Â  Â  Â  .logo { width: 60px; height: 60px; }
Â  Â  Â  Â  Â  Â  .nav-right { position: static; text-align: center; margin-top: 15px; }
Â  Â  Â  Â  Â  Â  .nav-left a { display: block; margin: 10px 0; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="home-page" class="page active">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="header-inner">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="logo.png" alt="Grid City Press Logo" class="logo">
Â  Â  Â  Â  Â  Â  Â  Â  <h1>The Grid City Press</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <nav class="main-nav">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="filterByTeam('Utah Athletics')">Utah Athletics</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="filterByTeam('Utah Mammoth')">Utah Mammoth</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="filterByTeam('Utah Jazz')">Utah Jazz</a>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-right" id="nav-auth"></div>
Â  Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  </header>
Â  Â  Â  Â  <div class="container">
Â  Â  Â  Â  Â  Â  <h2 class="section-title" id="articles-title">Latest Articles</h2>
Â  Â  Â  Â  Â  Â  <div id="articles-list"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <footer>&copy; <span id="year"></span> The Grid City Press. All rights reserved.</footer>
Â  Â  </div>

Â  Â  <div id="article-page" class="page">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="header-inner">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="logo.png" alt="Grid City Press Logo" class="logo">
Â  Â  Â  Â  Â  Â  Â  Â  <h1>The Grid City Press</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>
Â  Â  Â  Â  <div class="container">
Â  Â  Â  Â  Â  Â  <h1 id="article-title"></h1>
Â  Â  Â  Â  Â  Â  <small id="article-meta"></small>
Â  Â  Â  Â  Â  Â  <div class="article-content" id="article-content"></div>
Â  Â  Â  Â  Â  Â  <a class="back-link" onclick="showHome()">â† Back to Home</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="login-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Log In</h1>
Â  Â  Â  Â  Â  Â  <div id="login-message"></div>
Â  Â  Â  Â  Â  Â  <form class="auth-form" onsubmit="handleLogin(event)">
Â  Â  Â  Â  Â  Â  Â  Â  <label>Username</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="login-username" required>
Â  Â  Â  Â  Â  Â  Â  Â  <label>Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="login-password" required>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Log In</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <div class="auth-links">
Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="showRegister()">â†’ Create an Account</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="showHome()">â† Back to Home</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="register-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Create Account</h1>
Â  Â  Â  Â  Â  Â  <div id="register-message"></div>
Â  Â  Â  Â  Â  Â  <form class="auth-form" onsubmit="handleRegister(event)">
Â  Â  Â  Â  Â  Â  Â  Â  <label>Username</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="reg-username" required>
Â  Â  Â  Â  Â  Â  Â  Â  <label>Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="reg-password" required>
Â  Â  Â  Â  Â  Â  Â  Â  <label>I am aâ€¦</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="reg-role" required onchange="toggleAdminSecret()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- Select Role --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="user">User</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="admin">Admin</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="admin-secret-container" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Admin Secret</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="admin-secret">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Register</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <div class="auth-links">
Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="showLogin()">â† Back to Log In</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a onclick="showHome()">â† Back to Home</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="profile-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Your Profile</h1>
Â  Â  Â  Â  Â  Â  <div class="profile-info">
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Username:</strong> <span id="profile-username"></span></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Role:</strong> <span id="profile-role"></span></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="links">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showUpdateProfile()">Update Profile</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="admin-actions" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showAddArticle()">Add Article</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showDeleteArticles()">Delete Articles</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleLogout()">Log Out</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <a class="back-link" onclick="showHome()">â† Back to Home</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="update-profile-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Update Profile</h1>
Â  Â  Â  Â  Â  Â  <div id="update-message"></div>
Â  Â  Â  Â  Â  Â  <form class="auth-form" onsubmit="handleUpdateProfile(event)">
Â  Â  Â  Â  Â  Â  Â  Â  <label>Username</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="update-username" required>
Â  Â  Â  Â  Â  Â  Â  Â  <label>New Password <small>(leave blank to keep current)</small></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="update-password">
Â  Â  Â  Â  Â  Â  Â  Â  <label>Role</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="update-role" required onchange="toggleUpdateAdminSecret()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="user">User</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="admin">Admin</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="update-admin-secret-container" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Admin Secret</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="update-admin-secret">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Save Changes</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <a class="back-link" onclick="showProfile()">â† Back to Profile</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="add-article-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Publish a New Article</h1>
Â  Â  Â  Â  Â  Â  <div id="add-article-message"></div>
Â  Â  Â  Â  Â  Â  <form class="auth-form" onsubmit="handleAddArticle(event)">
Â  Â  Â  Â  Â  Â  Â  Â  <label>Title</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="new-article-title" required> Â  Â  Â  Â  Â  Â  Â  Â  <label>Article Date</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="new-article-date" required> Â  Â  Â  Â  Â  Â  Â  Â  <label>Team</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="new-article-team" required> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- Choose a Team --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Utah Athletics">Utah Athletics</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Utah Mammoth">Utah Mammoth</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Utah Jazz">Utah Jazz</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <label>Full Article (Paste from Google Docs)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="editor" contenteditable="true"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Publish Article</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <a class="back-link" onclick="showProfile()">â† Back to Profile</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="delete-articles-page" class="page">
Â  Â  Â  Â  <div class="auth-container">
Â  Â  Â  Â  Â  Â  <h1>Delete Articles</h1>
Â  Â  Â  Â  Â  Â  <div id="delete-message"></div>
Â  Â  Â  Â  Â  Â  <div id="delete-articles-list"></div>
Â  Â  Â  Â  Â  Â  <a class="back-link" onclick="showProfile()">â† Back to Profile</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
Â  Â  Â  Â  import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDZ7DADsKBXvHLe8oCG44v2-nDGg4zLLdY",
Â  Â  Â  Â  Â  Â  authDomain: "thegridcitypress-2da14.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "thegridcitypress-2da14",
Â  Â  Â  Â  Â  Â  storageBucket: "thegridcitypress-2da14.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "298645771353",
Â  Â  Â  Â  Â  Â  appId: "1:298645771353:web:74f2345d90fb9a81dfcd48"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  let articles = [];
Â  Â  Â  Â  let users = [];
Â  Â  Â  Â  let currentUser = null;
Â  Â  Â  Â  let currentFilter = null;

Â  Â  Â  Â  async function init() {
Â  Â  Â  Â  Â  Â  const savedUsers = localStorage.getItem('gridCityUsers');
Â  Â  Â  Â  Â  Â  users = savedUsers ? JSON.parse(savedUsers) : [];
Â  Â  Â  Â  Â  Â  const savedCurrentUser = sessionStorage.getItem('gridCityCurrentUser');
Â  Â  Â  Â  Â  Â  currentUser = savedCurrentUser ? JSON.parse(savedCurrentUser) : null;
Â  Â  Â  Â  Â  Â  document.getElementById('year').textContent = new Date().getFullYear();
Â  Â  Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  const dateInput = document.getElementById('new-article-date'); // CHANGED ID HERE
Â  Â  Â  Â  Â  Â  if(dateInput) dateInput.value = today;
Â  Â  Â  Â  Â  Â  updateAuthUI();
Â  Â  Â  Â  Â  Â  await loadArticles();
Â  Â  Â  Â  Â  Â  const articlesRef = collection(db, 'articles');
Â  Â  Â  Â  Â  Â  const q = query(articlesRef, orderBy('published_at', 'desc'));
Â  Â  Â  Â  Â  Â  onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  articles = [];
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach((d) => { articles.push({ id: d.id, ...d.data() }); });
Â  Â  Â  Â  Â  Â  Â  Â  displayArticles(currentFilter);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadArticles() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const articlesRef = collection(db, 'articles');
Â  Â  Â  Â  Â  Â  Â  Â  const q = query(articlesRef, orderBy('published_at', 'desc'));
Â  Â  Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â  articles = [];
Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((d) => { articles.push({ id: d.id, ...d.data() }); });
Â  Â  Â  Â  Â  Â  Â  Â  displayArticles();
Â  Â  Â  Â  Â  Â  } catch (error) { console.error('Error loading articles:', error); }
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveUsers() { localStorage.setItem('gridCityUsers', JSON.stringify(users)); }
Â  Â  Â  Â  function saveCurrentUser() {
Â  Â  Â  Â  Â  Â  if (currentUser) sessionStorage.setItem('gridCityCurrentUser', JSON.stringify(currentUser));
Â  Â  Â  Â  Â  Â  else sessionStorage.removeItem('gridCityCurrentUser');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.updateAuthUI = function() {
Â  Â  Â  Â  Â  Â  const navAuth = document.getElementById('nav-auth');
Â  Â  Â  Â  Â  Â  if (currentUser) navAuth.innerHTML = '<a onclick="showProfile()">' + escapeHtml(currentUser.username) + '</a><button onclick="handleLogout()">Log Out</button>';
Â  Â  Â  Â  Â  Â  else navAuth.innerHTML = '<a onclick="showLogin()">Log In</a><a onclick="showRegister()">Register</a>';
Â  Â  Â  Â  }

Â  Â  Â  Â  window.displayArticles = function(filter = null) {
Â  Â  Â  Â  Â  Â  const list = document.getElementById('articles-list');
Â  Â  Â  Â  Â  Â  const title = document.getElementById('articles-title');
Â  Â  Â  Â  Â  Â  let filtered = filter ? articles.filter(a => a.team === filter) : articles.slice();
Â  Â  Â  Â  Â  Â  title.textContent = filter ? filter + ' Articles' : 'Latest Articles';
Â  Â  Â  Â  Â  Â  filtered.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
Â  Â  Â  Â  Â  Â  const displayCount = filter ? filtered.length : Math.min(5, filtered.length);
Â  Â  Â  Â  Â  Â  const toDisplay = filtered.slice(0, displayCount);
Â  Â  Â  Â  Â  Â  if (toDisplay.length === 0) list.innerHTML = '<div class="empty-state"><p>No articles yet.</p></div>';
Â  Â  Â  Â  Â  Â  else list.innerHTML = toDisplay.map(a => '<a class="article-link" onclick="showArticle(\'' + a.id + '\')"><h3>' + escapeHtml(a.title) + '</h3><small>' + escapeHtml(a.team) + ' | ' + formatDate(a.published_at) + '</small></a>').join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatDate(dateStr) { return new Date(dateStr).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); }
Â  Â  Â  Â  function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
Â  Â  Â  Â  function hideAllPages() { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); }

Â  Â  Â  Â  window.showHome = function() {
Â  Â  Â  Â  Â  Â  currentFilter = null;
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('home-page').classList.add('active');
Â  Â  Â  Â  Â  Â  displayArticles();
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.filterByTeam = function(team) {
Â  Â  Â  Â  Â  Â  currentFilter = team;
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('home-page').classList.add('active');
Â  Â  Â  Â  Â  Â  displayArticles(team);
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showArticle = function(id) {
Â  Â  Â  Â  Â  Â  const article = articles.find(a => a.id === id);
Â  Â  Â  Â  Â  Â  if (!article) return;
Â  Â  Â  Â  Â  Â  document.getElementById('article-title').textContent = article.title;
Â  Â  Â  Â  Â  Â  document.getElementById('article-meta').textContent = article.team + ' | ' + formatDate(article.published_at);
Â  Â  Â  Â  Â  Â  document.getElementById('article-content').innerHTML = article.content;
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('article-page').classList.add('active');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showLogin = function() {
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('login-page').classList.add('active');
Â  Â  Â  Â  Â  Â  document.getElementById('login-message').innerHTML = '';
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showRegister = function() {
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('register-page').classList.add('active');
Â  Â  Â  Â  Â  Â  document.getElementById('register-message').innerHTML = '';
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showProfile = function() {
Â  Â  Â  Â  Â  Â  if (!currentUser) { showLogin(); return; }
Â  Â  Â  Â  Â  Â  document.getElementById('profile-username').textContent = currentUser.username;
Â  Â  Â  Â  Â  Â  document.getElementById('profile-role').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
Â  Â  Â  Â  Â  Â  document.getElementById('admin-actions').classList.toggle('hidden', currentUser.role !== 'admin');
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('profile-page').classList.add('active');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showUpdateProfile = function() {
Â  Â  Â  Â  Â  Â  if (!currentUser) return;
Â  Â  Â  Â  Â  Â  document.getElementById('update-username').value = currentUser.username;
Â  Â  Â  Â  Â  Â  document.getElementById('update-role').value = currentUser.role;
Â  Â  Â  Â  Â  Â  document.getElementById('update-password').value = '';
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('update-profile-page').classList.add('active');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showAddArticle = function() {
Â  Â  Â  Â  Â  Â  if (!currentUser || currentUser.role !== 'admin') { alert('You must be logged in as an admin to add articles.'); return; }
Â  Â  Â  Â  Â  Â  document.getElementById('new-article-title').value = ''; // CHANGED ID HERE
Â  Â  Â  Â  Â  Â  document.getElementById('editor').innerHTML = '';
Â  Â  Â  Â  Â  Â  document.getElementById('new-article-team').value = ''; // CHANGED ID HERE
Â  Â  Â  Â  Â  Â  document.getElementById('new-article-date').value = new Date().toISOString().split('T')[0]; // CHANGED ID HERE
Â  Â  Â  Â  Â  Â  document.getElementById('add-article-message').innerHTML = '';
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('add-article-page').classList.add('active');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.showDeleteArticles = function() {
Â  Â  Â  Â  Â  Â  if (!currentUser || currentUser.role !== 'admin') return;
Â  Â  Â  Â  Â  Â  const list = document.getElementById('delete-articles-list');
Â  Â  Â  Â  Â  Â  if (articles.length === 0) list.innerHTML = '<div class="empty-state"><p>No articles to delete.</p></div>';
Â  Â  Â  Â  Â  Â  else list.innerHTML = articles.map(article => '<div class="article-link"><h3>' + escapeHtml(article.title) + '</h3><small>' + escapeHtml(article.team) + ' | ' + formatDate(article.published_at) + '</small><br><button class="delete-button" onclick="deleteArticle(\'' + article.id + '\')">Delete</button></div>').join('');
Â  Â  Â  Â  Â  Â  hideAllPages();
Â  Â  Â  Â  Â  Â  document.getElementById('delete-articles-page').classList.add('active');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleAdminSecret = function() {
Â  Â  Â  Â  Â  Â  const role = document.getElementById('reg-role').value;
Â  Â  Â  Â  Â  Â  document.getElementById('admin-secret-container').classList.toggle('hidden', role !== 'admin');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleUpdateAdminSecret = function() {
Â  Â  Â  Â  Â  Â  const role = document.getElementById('update-role').value;
Â  Â  Â  Â  Â  Â  document.getElementById('update-admin-secret-container').classList.toggle('hidden', role !== 'admin');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleLogin = function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const username = document.getElementById('login-username').value.trim();
Â  Â  Â  Â  Â  Â  const password = document.getElementById('login-password').value;
Â  Â  Â  Â  Â  Â  const user = users.find(u => u.username === username && u.password === password);
Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  currentUser = { username: user.username, role: user.role };
Â  Â  Â  Â  Â  Â  Â  Â  saveCurrentUser();
Â  Â  Â  Â  Â  Â  Â  Â  updateAuthUI();
Â  Â  Â  Â  Â  Â  Â  Â  showHome();
Â  Â  Â  Â  Â  Â  } else showMessage('login-message', 'Invalid username or password.', true);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleRegister = function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const username = document.getElementById('reg-username').value.trim();
Â  Â  Â  Â  Â  Â  const password = document.getElementById('reg-password').value;
Â  Â  Â  Â  Â  Â  const role = document.getElementById('reg-role').value;
Â  Â  Â  Â  Â  Â  const adminSecret = document.getElementById('admin-secret').value;
Â  Â  Â  Â  Â  Â  if (!username || !password || !role) { showMessage('register-message', 'All fields are required.', true); return; }
Â  Â  Â  Â  Â  Â  if (role === 'admin' && adminSecret !== 'toor') { showMessage('register-message', 'Incorrect admin password.', true); return; }
Â  Â  Â  Â  Â  Â  if (users.find(u => u.username === username)) { showMessage('register-message', 'Username already taken.', true); return; }
Â  Â  Â  Â  Â  Â  users.push({ username, password, role });
Â  Â  Â  Â  Â  Â  saveUsers();
Â  Â  Â  Â  Â  Â  showMessage('register-message', 'Registration successful! <a onclick="showLogin()" style="color: darkgreen; text-decoration: underline; cursor: pointer;">Log in</a>.', false);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleUpdateProfile = function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  if (!currentUser) return;
Â  Â  Â  Â  Â  Â  const newUsername = document.getElementById('update-username').value.trim();
Â  Â  Â  Â  Â  Â  const newPassword = document.getElementById('update-password').value;
Â  Â  Â  Â  Â  Â  const newRole = document.getElementById('update-role').value;
Â  Â  Â  Â  Â  Â  const adminSecret = document.getElementById('update-admin-secret').value;
Â  Â  Â  Â  Â  Â  if (!newUsername || !newRole) { showMessage('update-message', 'Username and role are required.', true); return; }
Â  Â  Â  Â  Â  Â  if (newRole === 'admin' && adminSecret !== 'toor') { showMessage('update-message', 'Incorrect admin secret.', true); return; }
Â  Â  Â  Â  Â  Â  const userIndex = users.findIndex(u => u.username === currentUser.username);
Â  Â  Â  Â  Â  Â  if (userIndex === -1) return;
Â  Â  Â  Â  Â  Â  if (newUsername !== currentUser.username && users.find(u => u.username === newUsername)) { showMessage('update-message', 'Username already in use.', true); return; }
Â  Â  Â  Â  Â  Â  users[userIndex].username = newUsername;
Â  Â  Â  Â  Â  Â  if (newPassword) users[userIndex].password = newPassword;
Â  Â  Â  Â  Â  Â  users[userIndex].role = newRole;
Â  Â  Â  Â  Â  Â  currentUser = { username: newUsername, role: newRole };
Â  Â  Â  Â  Â  Â  saveCurrentUser();
Â  Â  Â  Â  Â  Â  saveUsers();
Â  Â  Â  Â  Â  Â  updateAuthUI();
Â  Â  Â  Â  Â  Â  showMessage('update-message', 'Profile updated successfully.', false);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleAddArticle = async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  if (!currentUser || currentUser.role !== 'admin') return;
Â  Â  Â  Â  Â  Â  // CHANGED IDs HERE to new-article-title, new-article-team, new-article-date
Â  Â  Â  Â  Â  Â  const title = document.getElementById('new-article-title').value.trim();
Â  Â  Â  Â  Â  Â  const editorContent = document.getElementById('editor').innerHTML.trim();
Â  Â  Â  Â  Â  Â  const team = document.getElementById('new-article-team').value;
Â  Â  Â  Â  Â  Â  const publishDate = document.getElementById('new-article-date').value;
Â  Â  Â  Â  Â  Â  const tempDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  tempDiv.innerHTML = editorContent;
Â  Â  Â  Â  Â  Â  const textContent = tempDiv.textContent.trim();
Â  Â  Â  Â  Â  Â  // REMOVED redundant title and team checks which are handled by the 'required' attribute on the inputs
Â  Â  Â  Â  Â  Â  if (textContent.length === 0) { // CHECK if content is empty (using plain text length)
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('add-article-message', 'The full article field cannot be empty. Please enter your article content in the editor.', true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(collection(db, 'articles'), { title, content: editorContent, team, published_at: publishDate });
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('add-article-message', 'Article published! ğŸ‰', false);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => showProfile(), 1500);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error adding article:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('add-article-message', 'Error publishing article: ' + error.message, true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.deleteArticle = async function(id) {
Â  Â  Â  Â  Â  Â  if (!confirm('Are you sure you want to delete this article?')) return;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, 'articles', id));
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('delete-message', 'Article deleted successfully.', false);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error deleting article:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('delete-message', 'Error deleting article.', true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleLogout = function() {
Â  Â  Â  Â  Â  Â  currentUser = null;
Â  Â  Â  Â  Â  Â  saveCurrentUser();
Â  Â  Â  Â  Â  Â  updateAuthUI();
Â  Â  Â  Â  Â  Â  showHome();
Â  Â  Â  Â  }

Â  Â  Â  Â  function showMessage(elementId, message, isError) {
Â  Â  Â  Â  Â  Â  document.getElementById(elementId).innerHTML = '<div class="message ' + (isError ? 'error' : '') + '">' + message + '</div>';
Â  Â  Â  Â  }

Â  Â  Â  Â  window.addEventListener('DOMContentLoaded', init);
Â  Â  </script>
</body>
</html>
