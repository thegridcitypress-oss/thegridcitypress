<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Grid City Press</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<style>
/* General styles */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Playfair Display', serif; background-color: #f9f9f9; color: #111; }
header { position: relative; background-color: white; border-bottom: 1px solid #ccc; padding: 30px 20px 20px; }
.header-inner { display: flex; align-items: center; justify-content: center; gap: 20px; max-width: 1000px; margin: 0 auto; }
.logo { width: 80px; height: 80px; flex-shrink: 0; }
header h1 { font-size: 3rem; font-weight: 700; letter-spacing: 1px; margin: 0; }
nav.main-nav { margin-top: 20px; margin-bottom: 30px; }
.nav-left { text-align: center; }
.nav-left a { text-decoration: none; color: #444; margin: 0 15px; font-weight: 600; font-size: 1rem; cursor: pointer; }
.nav-left a:hover { color: #000; }
.nav-right { position: absolute; top: 35px; right: 20px; }
.nav-right a, .nav-right button { text-decoration: none; color: #444; margin: 0 10px; font-weight: 600; font-size: 1rem; background: none; border: none; cursor: pointer; font-family: inherit; }
.nav-right a:hover, .nav-right button:hover { color: #000; }
.container { max-width: 800px; margin: 0 auto; padding: 0 20px 40px; }
h2.section-title { font-size: 1.8rem; margin: 20px 0 15px; font-weight: 700; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
.article-link { display: block; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; text-decoration: none; color: inherit; transition: background-color 0.2s ease; cursor: pointer; }
.article-link:hover { background-color: #f0f0f0; }
.article-link h3 { margin: 0 0 5px; font-size: 1.4rem; }
.article-link small { color: #777; font-size: 0.9rem; }
footer { text-align: center; color: #aaa; font-size: 0.8rem; padding: 20px; border-top: 1px solid #ddd; }
.page { display: none; }
.page.active { display: block; }
.article-content { margin-top: 30px; line-height: 1.8; }
.article-content p { margin-bottom: 1.2em; }
.back-link { display: inline-block; margin-top: 30px; text-decoration: none; color: #444; font-weight: 600; cursor: pointer; }
.back-link:hover { color: #000; text-decoration: underline; }
.auth-container { max-width: 600px; margin: 50px auto; padding: 0 20px; }
.auth-container h1 { text-align: center; margin-bottom: 30px; }
.auth-form label { display: block; margin-top: 20px; font-weight: bold; }
.auth-form input, .auth-form select { width: 100%; padding: 10px; margin-top: 5px; font-family: inherit; font-size: inherit; border: 1px solid #ccc; }
.auth-form button { margin-top: 20px; padding: 10px 20px; background-color: #000; color: #fff; border: none; cursor: pointer; font-family: inherit; font-size: inherit; }
.auth-form button:hover { background-color: #333; }
.message { margin-top: 20px; padding: 10px; font-weight: bold; color: darkgreen; background-color: #e8f5e9; border: 1px solid #4caf50; border-radius: 4px; }
.message.error { color: darkred; background-color: #ffebee; border-color: #f44336; }
.auth-links { margin-top: 20px; }
.auth-links a { color: #444; text-decoration: none; display: block; margin-top: 10px; cursor: pointer; }
.hidden { display: none; }
.profile-info { margin: 20px 0; }
.profile-info p { margin: 10px 0; }
.links { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; }
.links a, .links button { text-decoration: none; background-color: #000; color: #fff; padding: 10px 15px; font-weight: 600; text-align: center; border-radius: 4px; cursor: pointer; border: none; font-family: inherit; font-size: inherit; }
.links a:hover, .links button:hover { background-color: #333; }
#editor { border: 1px solid #ccc; padding: 15px; min-height: 300px; background-color: white; margin-top: 5px; overflow-y: auto; }
.delete-button { margin-top: 10px; display: inline-block; padding: 6px 12px; background-color: crimson; color: white; text-decoration: none; font-size: 0.9rem; border-radius: 4px; border: none; cursor: pointer; font-family: inherit; }
.delete-button:hover { background-color: darkred; }
.empty-state { text-align: center; padding: 40px 20px; color: #777; }
@media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    .logo { width: 60px; height: 60px; }
    .nav-right { position: static; text-align: center; margin-top: 15px; }
    .nav-left a { display: block; margin: 10px 0; }
}
</style>
</head>
<body>

<!-- Home Page -->
<div id="home-page" class="page active">
    <header>
        <div class="header-inner">
            <img src="logo.png" alt="Grid City Press Logo" class="logo" onerror="this.style.display='none'">
            <h1>The Grid City Press</h1>
        </div>
        <nav class="main-nav">
            <div class="nav-left">
                <a onclick="filterByTeam('Utah Athletics')">Utah Athletics</a>
                <a onclick="filterByTeam('Utah Mammoth')">Utah Mammoth</a>
                <a onclick="filterByTeam('Utah Jazz')">Utah Jazz</a>
            </div>
            <div class="nav-right" id="nav-auth"></div>
        </nav>
    </header>
    <div class="container">
        <h2 class="section-title" id="articles-title">Latest Articles</h2>
        <div id="articles-list"></div>
    </div>
    <footer>&copy; <span id="year"></span> The Grid City Press. All rights reserved.</footer>
</div>

<!-- Article Page -->
<div id="article-page" class="page">
    <header>
        <div class="header-inner">
            <img src="logo.png" alt="Grid City Press Logo" class="logo" onerror="this.style.display='none'">
            <h1>The Grid City Press</h1>
        </div>
    </header>
    <div class="container">
        <h1 id="article-title"></h1>
        <small id="article-meta"></small>
        <div class="article-content" id="article-content"></div>
        <a class="back-link" onclick="showHome()">← Back to Home</a>
    </div>
</div>

<!-- Login Page -->
<div id="login-page" class="page">
    <div class="auth-container">
        <h1>Log In</h1>
        <div id="login-message"></div>
        <form class="auth-form" onsubmit="handleLogin(event)">
            <label>Username</label>
            <input type="text" id="login-username" required>
            <label>Password</label>
            <input type="password" id="login-password" required>
            <button type="submit">Log In</button>
        </form>
        <div class="auth-links">
            <a onclick="showRegister()">→ Create an Account</a>
            <a onclick="showHome()">← Back to Home</a>
        </div>
    </div>
</div>

<!-- Register Page -->
<div id="register-page" class="page">
    <div class="auth-container">
        <h1>Create Account</h1>
        <div id="register-message"></div>
        <form class="auth-form" onsubmit="handleRegister(event)">
            <label>Username</label>
            <input type="text" id="reg-username" required>
            <label>Password</label>
            <input type="password" id="reg-password" required>
            <label>I am a…</label>
            <select id="reg-role" required onchange="toggleAdminSecret()">
                <option value="">-- Select Role --</option>
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <div id="admin-secret-container" class="hidden">
                <label>Admin Secret</label>
                <input type="password" id="admin-secret">
            </div>
            <button type="submit">Register</button>
        </form>
        <div class="auth-links">
            <a onclick="showLogin()">← Back to Log In</a>
            <a onclick="showHome()">← Back to Home</a>
        </div>
    </div>
</div>

<!-- Profile Page -->
<div id="profile-page" class="page">
    <div class="profile-info">
        <p>Username: <span id="profile-username"></span></p>
        <p>Role: <span id="profile-role"></span></p>
    </div>
    <div class="links">
        <button type="button" onclick="showUpdateProfile()">Update Profile</button>
        <div id="admin-actions" class="hidden">
            <button type="button" onclick="showAddArticle()">Add Article</button>
            <button type="button" onclick="showDeleteArticles()">Delete Articles</button>
        </div>
        <button type="button" onclick="handleLogout()">Log Out</button>
    </div>
    <a class="back-link" onclick="showHome()">← Back to Home</a>
</div>

<!-- Update Profile Page -->
<div id="update-profile-page" class="page">
    <div class="auth-container">
        <h1>Update Profile</h1>
        <div id="update-message"></div>
        <form class="auth-form" onsubmit="handleUpdateProfile(event)">
            <label>Username</label>
            <input type="text" id="update-username" required>
            <label>New Password <small>(leave blank to keep current)</small></label>
            <input type="password" id="update-password">
            <label>Role</label>
            <select id="update-role" required onchange="toggleUpdateAdminSecret()">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <div id="update-admin-secret-container" class="hidden">
                <label>Admin Secret</label>
                <input type="password" id="update-admin-secret">
            </div>
            <button type="submit">Save Changes</button>
        </form>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>
</div>

<!-- Add Article Page -->
<div id="add-article-page" class="page">
    <div class="auth-container">
        <h1>Publish a New Article</h1>
        <div id="add-article-message"></div>
        <form class="auth-form" onsubmit="handleAddArticle(event)">
            <label>Title</label>
            <input type="text" id="add-article-title" required>
            <label>Article Date</label>
            <input type="date" id="add-article-date" required>
            <label>Team</label>
            <select id="add-article-team" required>
                <option value="">-- Choose a Team --</option>
                <option value="Utah Athletics">Utah Athletics</option>
                <option value="Utah Mammoth">Utah Mammoth</option>
                <option value="Utah Jazz">Utah Jazz</option>
            </select>
            <label>Full Article (Paste from Google Docs)</label>
            <div id="add-article-editor" contenteditable="true" style="border:1px solid #ccc; min-height:200px; padding:10px;"></div>
            <button type="submit">Publish Article</button>
        </form>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>
</div>

<!-- Delete Articles Page -->
<div id="delete-articles-page" class="page">
    <div class="auth-container">
        <h1>Delete Articles</h1>
        <div id="delete-message"></div>
        <div id="delete-articles-list"></div>
        <a class="back-link" onclick="showProfile()">← Back to Profile</a>
    </div>
</div>

<script type="module">
// Firebase initialization
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
    apiKey: "AIzaSyDZ7DADsKBXvHLe8oCG44v2-nDGg4zLLdY",
    authDomain: "thegridcitypress-2da14.firebaseapp.com",
    projectId: "thegridcitypress-2da14",
    storageBucket: "thegridcitypress-2da14.appspot.com",
    messagingSenderId: "298645771353",
    appId: "1:298645771353:web:74f2345d90fb9a81dfcd48"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let articles = [];
let users = [];
let currentUser = null;
let currentFilter = null;

async function init() {
    const savedUsers = localStorage.getItem('gridCityUsers');
    users = savedUsers ? JSON.parse(savedUsers) : [];
    const savedCurrentUser = sessionStorage.getItem('gridCityCurrentUser');
    currentUser = savedCurrentUser ? JSON.parse(savedCurrentUser) : null;

    document.getElementById('year').textContent = new Date().getFullYear();

    const dateInput = document.getElementById('add-article-date');
    if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];

    updateAuthUI();
    await loadArticles();

    const articlesRef = collection(db, 'articles');
    const q = query(articlesRef, orderBy('published_at', 'desc'));
    onSnapshot(q, (snapshot) => {
        articles = [];
        snapshot.forEach((d) => { articles.push({ id: d.id, ...d.data() }); });
        displayArticles(currentFilter);
    });
}

// --- Continue with JS functions: showPage, showHome, showLogin, showRegister, handleLogin, handleRegister, filterByTeam, displayArticles, showArticle, showProfile, showAddArticle, showDeleteArticles, handleAddArticle, handleDeleteArticle, handleLogout, etc. --- //

init();
</script>
</body>
</html>

    </script>
</body>
</html>
